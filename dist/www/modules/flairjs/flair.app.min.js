/**
 * @preserve
 * Flair.js
 * True Object Oriented JavaScript
 * 
 * Assembly: flair.app
 *     File: ./flair.app.js
 *  Version: 0.25.76
 *  Mon, 18 Mar 2019 22:04:59 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * Licensed under MIT
 */
(()=>{"use strict";const e=void 0!==!0?require("flairjs"):"undefined"!=typeof WorkerGlobalScope?WorkerGlobalScope.flair:(!0).flair,{Class:t,Struct:r,Enum:s,Interface:o,Mixin:n}=e,{Aspects:i}=e,{AppDomain:a}=e,l=e.AppDomain.context.current().name,{$$:c,attr:p}=e,{bring:u,Container:f,include:d}=e,{Port:h}=e,{on:m,post:v,telemetry:b}=e,{Reflector:y}=e,{Serializer:g}=e,{Tasks:$}=e,{TaskInfo:w}=e.Tasks,{as:S,is:O,isComplies:x,isDerivedFrom:A,isImplements:j,isInstanceOf:H,isMixed:C}=e,{getAssembly:E,getAttr:R,getContext:T,getResource:k,getRoute:B,getType:D,ns:I,getTypeOf:M,typeOf:z}=e,{dispose:F,using:P}=e,{Args:q,Exception:V,noop:L,nip:W,nim:N,nie:G,event:U}=e,{env:J}=e.options,{forEachAsync:K,replaceAll:Q,splitAndTrim:X,findIndexByProp:Y,findItemByProp:Z,which:_,isArrowFunc:ee,isASyncFunc:te,sieve:re,b64EncodeUnicode:se,b64DecodeUnicode:oe}=e.utils,{$static:ne,$abstract:ie,$virtual:ae,$override:le,$sealed:ce,$private:pe,$privateSet:ue,$protected:fe,$protectedSet:de,$readonly:he,$async:me}=c,{$enumerate:ve,$dispose:be,$post:ye,$on:ge,$timer:$e,$type:we,$args:Se,$inject:Oe,$resource:xe,$asset:Ae,$singleton:je,$serialize:He,$deprecate:Ce,$session:Ee,$state:Re,$conditional:Te,$noserialize:ke,$ns:Be}=c;let De=JSON.parse('{"host":"flair.boot.ServerHost | flair.boot.ClientHost","app":"App","load":[],"container":{},"envVars":[],"envVarsloadOptions":{"overwrite":true},"mounts":{"main":"/"},"main-appSettings":[],"main-middlewares":[],"server-http":{"enable":false,"port":80,"timeout":-1},"server-https":{"enable":false,"port":443,"timeout":-1,"privateKey":"","publicCert":""}}'),Ie=e.Port("settingsReader");if("function"==typeof Ie){let e=Ie("flair.app");e&&(De=Object.assign(De,e))}De=Object.freeze(De),e.AppDomain.context.current().currentAssemblyBeingLoaded("./flair.app{.min}.js"),(async()=>{const e=await d("[Page]","page"),{Host:r}=I("flair.app");c("sealed"),c("ns","flair.boot"),t("ClientHost",r,function(){let t={},r=null;c("override"),this.construct=(e=>{e("Page","1.x")}),this.app=(()=>this.mounts["main"]),this.mounts={get:()=>t,set:L},c("override"),this.boot=(async r=>{r();let s=null,o="",n=null;const i=e=>{let t={},r=De[`${e}-appSettings`];if(r&&r.length>0)for(let e of r)t[e.name]=e.value;return t.click=!1,t.popstate=!1,t.dispatch=!1,t.hashbang=!1,t.decodeURLComponents=!0,t};s=i("main");let a=e.create(s);a.strict(s.strict),a.base("/");for(let r of Object.keys(De.mounts))"main"===r?(o="/",n=a):(s=i(r),o=De.mounts[r],(n=e.create(s)).strict(s.strict),n.base(o)),t[r]=Object.freeze({name:r,root:o,app:n});t=Object.freeze(t)}),c("override"),this.start=(async e=>{e(),r=(()=>{let e=J.global.location.hash;"#!/"===e.substr(0,3)&&(e=e.substr(3)),"#!"===e.substr(0,2)&&(e=e.substr(2)),"#/"===e.substr(0,2)&&(e=e.substr(2)),"#"===e.substr(0,1)&&(e=e.substr(1));let t=null;for(let r of this.mounts)if(e.startsWith(r.root)){t=r.app,e=e.substr(r.root.length);break}t||(t=this.mounts["main"]),setTimeout(()=>{try{t(e)}catch(e){this.error(e)}},0)})}),c("override"),this.ready=(async e=>{e(),J.global.addEventListener("hashchange",r),console.log(`${a.app().info.name}, v${a.app().info.version}`)}),c("override"),this.stop=(async e=>{e(),J.global.removeEventListener("hashchange",r)}),c("override"),this.dispose=(e=>{e(),t=null})})})(),(async()=>{const e=require("express"),r=require("fs"),s=require("http"),o=require("https"),n=require("http-shutdown"),{Host:i}=I("flair.app");c("sealed"),c("ns","flair.boot"),t("ServerHost",i,function(){let t={},i=null,l=null,p=De["server-https"],u=De["server-http"];c("override"),this.construct=(e=>{e("Express","4.x")}),this.app=(()=>this.mounts["main"]),this.mounts={get:()=>t,set:L},c("override"),this.boot=(async r=>{r();const s=(e,t)=>{let r=De[`${e}-appSettings`];if(r&&r.length>0)for(let e of r)t.set(e.name,e.value)};let o=e();s("main",o);let n="",i=null;for(let r of Object.keys(De.mounts))"main"===r?(n="/",i=o):(n=De.mounts[r],i=e()),t[r]=Object.freeze({name:r,root:n,app:i}),"main"!==r&&(s(r,i),o.use(n,i));t=Object.freeze(t)}),c("override"),this.start=(async e=>{if(e(),u.enable&&(i=s.createServer(this.app()),(i=n(i)).on("error",this.error),-1!==u.timeout&&(i.timeout=u.timeout)),p.enable){const e=r.readFileSync(p.privateKey,"utf8"),t=r.readFileSync(p.publicCert,"utf8"),s={key:e,cert:t};l=o.createServer(s,this.app()),(l=n(l)).on("error",this.error),-1!==p.timeout&&(l.timeout=p.timeout)}}),c("override"),this.ready=(async e=>{e();let t=u.port||80,r=process.env.PORT||p.port||443;i&&l?i.listen(t,()=>{i.listen(r,()=>{console.log(`${a.app().info.name}, v${a.app().info.version} (http: ${t}, https: ${r})`)})}):i?i.listen(t,()=>{console.log(`${a.app().info.name}, v${a.app().info.version} (http: ${t})`)}):l?l.listen(r,()=>{console.log(`${a.app().info.name}, v${a.app().info.version} (https: ${r})`)}):console.log(`${a.app().info.name}, v${a.app().info.version}`)}),c("override"),this.stop=(async e=>{e(),i&&(console.log("http server is shutting down..."),i.shutdown(()=>{i=null,console.log("http server is cleanly shutdown!")})),l&&(console.log("https server is shutting down..."),l.shutdown(()=>{l=null,console.log("https server is cleanly shutdown!")}))}),c("override"),this.dispose=(e=>{e(),t=null})})})(),(async()=>{const{Bootware:e}=I("flair.app");c("sealed"),c("ns","flair.bw"),t("DIContainer",e,function(){c("override"),this.construct=(e=>{e("DI Container")}),c("override"),this.boot=(async()=>{let e=De.container;for(let t in e)e.hasOwnProperty(t)&&f.register(t,e[t])})})})(),(async()=>{const{Bootware:e}=I("flair.app");c("sealed"),c("ns","flair.bw"),t("Middlewares",e,function(){c("override"),this.construct=(e=>{e("Express Middlewares",!0)}),c("override"),this.boot=(async e=>{let t=De[`${e.name}-middlewares`];if(t&&t.length>0){let r=null,s=null;for(let o of t)if(o.module)try{r=require(o.name),s=o.func?r[o.func]:r;let t=[],n=null;o.args=o.args||[];for(let e of o.args){if("string"==typeof e&&e.startsWith("return "))n=new Function(e)();else if("object"==typeof e)for(let t in e)e.hasOwnProperty(t)&&"string"==typeof(n=e[t])&&n.startsWith("return ")&&(n=new Function(e)(),e[t]=n);else n=e;t.push(n)}e.app.use(s(...t))}catch(e){throw V.OperationFailed(`Middleware ${o.module} load failed.`,e,this.boot)}}})})})(),(async()=>{const e=require("node-env-file"),{Bootware:r}=I("flair.app");c("sealed"),c("ns","flair.bw"),t("NodeEnv",r,function(){c("override"),this.construct=(e=>{e("Node Server Environment")}),c("override"),this.boot=(async()=>{if(De.envVars.length>0)for(let t of De.envVars)e(t,De.envVarsLoadOptions)})})})(),(async()=>{const{Bootware:e}=I("flair.app");c("sealed"),c("ns","flair.bw"),t("ResHeaders",e,function(){c("override"),this.construct=(e=>{e("Server Response Headers",!0)}),c("override"),this.boot=(async e=>{let t=De[`${e.name}-resHeaders`];t&&t.length>0&&e.app.use((e,r,s)=>{for(let e of t)r.setHeader(e.name,e.value);s()})})})})(),(async()=>{const{Bootware:e}=I("flair.app");c("sealed"),c("ns","flair.bw"),t("Router",e,function(){let e=null;c("override"),this.construct=(e=>{e("Router",!0)}),c("override"),this.boot=(async t=>{e||(e=a.context.current().allRoutes(!0)).sort((e,t)=>e.index<t.index?-1:e.index>t.index?1:0);let r=null,s=!1;const o=()=>{for(let o of e)o.mount===t.name&&(t.app[o.verb]=(o.path,(e,t,n)=>{const i=e=>{e?t.end():n()},l=e=>{t.status(500).end(),a.host().raiseError(e)};try{r=new o.Handler,"function"==typeof(s=r[o.verb](e,t)).then?s.then(e=>{i(e)}).catch(l):i(s)}catch(e){l(e)}}))},n=()=>{for(let o of e)o.mount===t.name&&t.app(o.path,(e,t)=>{const n=e=>{e||t()},i=e=>{a.host().raiseError(e)};try{r=new o.Handler,"function"==typeof(s=r[o.verb](e)).then?s.then(e=>{n(e)}).catch(i):n(s)}catch(e){i(e)}})};J.isServer?o():n()})})})(),e.AppDomain.context.current().currentAssemblyBeingLoaded(""),e.AppDomain.registerAdo('{"name":"flair.app","file":"./flair.app{.min}.js","desc":"True Object Oriented JavaScript","title":"Flair.js","version":"0.25.76","lupdate":"Mon, 18 Mar 2019 22:04:59 GMT","builder":{"name":"<<name>>","version":"<<version>>","format":"fasm","formatVersion":"1","contains":["initializer","types","enclosureVars","enclosedTypes","resources","assets","routes","selfreg"]},"copyright":"(c) 2017-2019 Vikas Burman","license":"MIT","types":["flair.boot.ClientHost","flair.boot.ServerHost","flair.bw.DIContainer","flair.bw.Middlewares","flair.bw.NodeEnv","flair.bw.ResHeaders","flair.bw.Router"],"resources":[],"assets":[],"routes":[]}')})();
//# sourceMappingURL=./flair.app.min.js.map